(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[577],{2977:(e,t,r)=>{Promise.resolve().then(r.bind(r,7742))},7742:(e,t,r)=>{"use strict";r.d(t,{default:()=>b});var n=r(5155),i=r(2115),a=r(2653),l=r(4456),s=r(5565);let o=e=>Array.isArray(e)?e[0]:e,u=e=>{let t=o(e);if("number"==typeof t&&Number.isFinite(t)&&t>0){if(t>=1){let e=Number.isInteger(t)?t.toFixed(0):t.toFixed(1);return"".concat(e,"s")}let e=Math.round(1/t);return"1/".concat(e,"s")}return"string"==typeof t&&t.trim()?t.trim():null},c=e=>{let t=o(e);return"number"==typeof t&&Number.isFinite(t)?Number.isInteger(t)?t.toFixed(0):t.toFixed(1):"string"==typeof t&&t.trim()?t.trim():null},d=e=>{let t=o(e);return"number"==typeof t&&Number.isFinite(t)?Math.round(t).toString():"string"==typeof t&&t.trim()?t.trim():null},m=(e,t)=>{let r="string"==typeof e?e.trim():"",n="string"==typeof t?t.trim():"";return r||n?r?n?n.toLowerCase().includes(r.toLowerCase())?n:"".concat(r," ").concat(n):r:n:null},f=e=>{if(!e)return null;if(e instanceof Date)return e;if("number"==typeof e&&Number.isFinite(e))return new Date(e);if("string"!=typeof e)return null;let t=e.trim();if(!t)return null;let r=t.match(/^(\d{4})[/:\\-](\d{2})[/:\\-](\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2}))?/);if(r){let[,e,t,n,i="00",a="00",l="00"]=r,s=new Date(Number(e),Number(t)-1,Number(n),Number(i),Number(a),Number(l));return Number.isNaN(s.getTime())?null:s}let n=new Date(t);return Number.isNaN(n.getTime())?null:n},p=e=>{let t=f(e);if(!t)return null;let r=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return"".concat(r,"/").concat(n,"/").concat(i)},h=e=>{var t;if(!e)return null;let r=p(e.DateTimeOriginal||e.CreateDate),n=m(e.Make,e.Model),i="string"==typeof e.Model?e.Model.trim():null,a="string"==typeof e.LensModel?e.LensModel.trim():null,l=u(e.ExposureTime),s=c(e.FNumber),o=d(null!==(t=e.ISO)&&void 0!==t?t:e.ISOSpeed);return r||n||a||l||s||o?{shotDate:r,camera:n,cameraModel:i,lens:a,shutterSpeed:l,aperture:s,iso:o}:null},x=["DateTimeOriginal","CreateDate","Make","Model","LensModel","ExposureTime","FNumber","ISO","ISOSpeed"];function g(e){let{src:t,alt:a="",exif:l,dateText:o,dateLabel:u,loading:c="lazy",priority:d=!1,decoding:m="async",deferUntilVisible:f=!1,enableClientExif:p=!1,exifKey:g,onClick:b,onImageLoad:v,onExifResolved:y}=e,[N,w]=function(){let{threshold:e=.1,rootMargin:t="200px"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,i.useRef)(null),[n,a]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{let n=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting&&(a(!0),n.disconnect())},{rootMargin:t,threshold:e});return r.current&&n.observe(r.current),()=>n.disconnect()},[e,t]),[r,n]}({threshold:.1,rootMargin:"200px"}),[j,S]=(0,i.useState)(l||null),k=(0,i.useRef)(null),T=!f||w;(0,i.useEffect)(()=>{l&&S(l)},[l]),(0,i.useEffect)(()=>{j&&y&&y(g||t,j)},[j,y,t,g]),(0,i.useEffect)(()=>{if(!p||j||!w||!(null==t?void 0:t.startsWith("/photos/"))||k.current===t)return;k.current=t;let e=!1;return(async()=>{try{let{default:n}=await r.e(247).then(r.bind(r,6247)),i=await n.parse(t,{pick:x}),a=h(i);e||S(a)}catch(t){e||S(null)}})(),()=>{e=!0}},[j,w,t]);let D=null==j?void 0:j.shotDate,M=o||D,E=o?u:null,F=!!M;return(0,n.jsx)("div",{ref:N,className:"transition-all duration-700 ease-out opacity-0 translate-y-8 ".concat(w?"opacity-100 translate-y-0":""),children:(0,n.jsxs)("button",{type:"button",className:"relative block w-full aspect-square overflow-hidden",onClick:()=>{b&&b(j||null)},children:[T&&(0,n.jsx)(s.default,{src:t,alt:a,fill:!0,className:"object-cover",loading:c,priority:d,decoding:m,onLoadingComplete:v,onError:v}),F&&(0,n.jsx)("div",{className:"pointer-events-none absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/70 via-black/40 to-transparent px-2 pb-2 pt-6",children:(0,n.jsx)("div",{className:"text-[11px] text-gray-100 tracking-[0.18em]",children:E?"".concat(E,": ").concat(M):M})})]})})}function b(e){let{images:t}=e,s=e=>{if(!e)return 0;if(e instanceof Date){let t=e.getTime();return Number.isNaN(t)?0:t}if("number"==typeof e&&Number.isFinite(e))return e;if("string"!=typeof e)return 0;let t=e.trim();if(!t)return 0;let r=t.match(/^(\d{4})[/:\\-](\d{2})[/:\\-](\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2}))?/);if(r){let[,e,t,n,i="00",a="00",l="00"]=r,s=new Date(Number(e),Number(t)-1,Number(n),Number(i),Number(a),Number(l));return Number.isNaN(s.getTime())?0:s.getTime()}let n=new Date(t);return Number.isNaN(n.getTime())?0:n.getTime()},o=(0,a.I)(),u=(0,i.useMemo)(()=>({initial:{opacity:0,y:o?0:16},animate:{opacity:1,y:0,transition:{duration:o?0:.6,ease:[.16,1,.3,1]}}}),[o]),[c,d]=(0,i.useState)(0),m=(0,i.useRef)(new Map),[f,p]=(0,i.useState)(!1),[b,v]=(0,i.useState)(!1),[y,N]=(0,i.useState)(""),[w,j]=(0,i.useState)(null),[S,k]=(0,i.useState)(!1),[T,D]=(0,i.useState)(!1),M=(0,i.useRef)(new Set);(0,i.useEffect)(()=>{t.forEach(e=>{(null==e?void 0:e.exif)&&m.current.set(e.src,e.exif)})},[t]),(0,i.useEffect)(()=>{let e=window.matchMedia("(max-width: 640px)"),t=()=>{p(e.matches)};return t(),e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]);let E=(e,t)=>{if(!e||!t)return;let r=m.current.get(e),n=(null==t?void 0:t.shotDate)||null,i=(null==r?void 0:r.shotDate)||null;r&&n===i||(m.current.set(e,t),d(e=>e+1))},F=e=>{var t;let r=Number.isFinite(null==e?void 0:e.sortTs)?e.sortTs:0;if(r>0)return r;let n=s(null==e?void 0:e.publishedDate);if(n)return n;let i=(null==e?void 0:e.src)?m.current.get(e.src):null;return s((null==i?void 0:i.shotDate)||(null==e?void 0:null===(t=e.exif)||void 0===t?void 0:t.shotDate))},I=(0,i.useMemo)(()=>t.map((e,t)=>({item:e,idx:t,sortTs:F(e)})).sort((e,t)=>t.sortTs-e.sortTs||e.idx-t.idx).map(e=>{let{item:t}=e;return t}),[t,c]),L=I.length,[C,O]=(0,i.useState)(0),[P,_]=(0,i.useState)(L>0),[R,z]=(0,i.useState)(!1),A=(null==w?void 0:w.shotDate)?(e=>{if(!e)return null;let t=s(e);if(!t)return e;let r=new Date(t),n=r.getFullYear(),i=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0");return"".concat(n,"-").concat(i,"-").concat(a)})(w.shotDate):null,W=(null==w?void 0:w.cameraModel)||(null==w?void 0:w.camera),Y=null==w?void 0:w.lens,U=null==w?void 0:w.shutterSpeed,q=null==w?void 0:w.iso,G=(e=>{if(null==e)return null;let t=String(e).trim();if(!t)return null;let r=t.replace(/^f\/?/i,"");return r?"F".concat(r):null})(null==w?void 0:w.aperture),H=S&&T,K=()=>{O(e=>Math.min(e+1,L))};(0,i.useEffect)(()=>{O(e=>Math.min(e,L))},[L]);let B=L>0?Math.round(C/L*100):100;(0,i.useEffect)(()=>{if(P&&100===B){let e=setTimeout(()=>{z(!0);let e=setTimeout(()=>_(!1),500);return()=>clearTimeout(e)},500);return()=>clearTimeout(e)}},[B,P]),(0,i.useEffect)(()=>{if(!P)return;let e=setTimeout(()=>{z(!0),setTimeout(()=>_(!1),500)},4e3);return()=>clearTimeout(e)},[P]);let J=R?"opacity-0 transition-opacity duration-500":"opacity-100",Q=R||!P?"opacity-100 transition-opacity duration-500":"opacity-0",V=(e,t)=>{let r=t||m.current.get(e)||null;N(e),j(r),k(!1),D(!!r),v(!0)},X=()=>{N(""),j(null),k(!1),D(!1),v(!1)};(0,i.useEffect)(()=>{if(!b||!y)return;if(w||!y.startsWith("/photos/")){T||D(!0);return}if(M.current.has(y))return;M.current.add(y);let e=!1;return(async()=>{try{let{default:t}=await r.e(247).then(r.bind(r,6247)),n=await t.parse(y,{pick:x}),i=h(n);e||(j(i),D(!0))}catch(t){e||(j(null),D(!0))}})(),()=>{e=!0}},[b,y,w,T]);let Z=e=>{window.open(e,"_blank")},$=e=>{if(!(null==e?void 0:e.src))return"";if(!e.isLocal||!f)return e.src;let t=e.src.split("/").pop();return"/photos/mobile/".concat(t)},ee=e=>{if(!e)return"Photo work";if(e.isLocal){var t,r;let n=(null===(t=e.exif)||void 0===t?void 0:t.shotDate)||(null===(r=e.src)||void 0===r?void 0:r.split("/").pop());return n?"Photo work ".concat(n):"Photo work"}let n=e.publishedDate;return n?"Photo work ".concat(n):"Photo work"};return(0,n.jsxs)("div",{className:"mx-auto max-w-6xl px-6 py-10",children:[P&&(0,n.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-black ".concat(J),children:[(0,n.jsxs)("span",{className:"text-white text-2xl mb-4",style:{fontFamily:"'Avenir Next', 'Yu Gothic', sans-serif"},children:[B,"%"]}),(0,n.jsx)("div",{className:"w-[80vw] max-w-[500px] h-1 bg-black relative overflow-hidden",children:(0,n.jsx)("div",{className:"absolute left-0 top-0 h-full bg-white transition-all",style:{width:"".concat(B,"%")}})})]}),(0,n.jsx)("div",{className:Q,children:(0,n.jsx)(l.P.div,{initial:u.initial,animate:u.animate,children:(0,n.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:I.map(e=>{let t=$(e),r=ee(e);return e.isLocal?(0,n.jsx)(g,{src:t,alt:r,exifKey:e.src,exif:e.exif,loading:"eager",priority:!0,onClick:t=>V(e.src,t||e.exif),onImageLoad:K,onExifResolved:E},e.src):(0,n.jsx)(g,{src:e.src,alt:r,dateText:e.publishedDate,loading:"eager",priority:!0,onClick:()=>Z(e.postUrl),onImageLoad:K},e.src)})})})}),b&&(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:X,children:(0,n.jsxs)("div",{className:"relative max-w-[90%] max-h-[90%]",onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("button",{onClick:X,"aria-label":"Close",className:"absolute top-4 right-4 z-20 flex h-10 w-10 items-center justify-center rounded bg-gray-700/80 text-white text-2xl leading-none transition-opacity duration-300 ".concat(H?"opacity-100":"opacity-0 pointer-events-none"," hover:bg-gray-600"),children:"\xd7"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("img",{src:y,alt:"",className:"w-full h-full object-contain transition-opacity duration-300 ".concat(H?"opacity-100":"opacity-0"),style:{maxHeight:"90vh",maxWidth:"90vw"},onLoad:()=>k(!0),onError:()=>k(!0)}),(0,n.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-3 transition-opacity duration-300 ".concat(H?"opacity-0 pointer-events-none":"opacity-100"),"aria-hidden":H,children:[(0,n.jsx)("div",{className:"text-[11px] uppercase tracking-[0.45em] text-gray-200",children:"Loading"}),(0,n.jsx)("div",{className:"h-px w-28 overflow-hidden bg-white/25",children:(0,n.jsx)("div",{className:"h-px w-1/2 bg-white/80 animate-pulse"})})]}),w&&H&&(0,n.jsx)("div",{className:"pointer-events-none absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 via-black/50 to-transparent px-4 pb-4 pt-10",children:(0,n.jsxs)("div",{className:"flex flex-wrap gap-x-4 gap-y-2 text-xs text-gray-100 leading-relaxed",children:[A&&(0,n.jsxs)("span",{children:["撮影日：",A]}),W&&(0,n.jsxs)("span",{children:["カメラ：",W]}),Y&&(0,n.jsxs)("span",{children:["レンズ：",Y]}),U&&(0,n.jsxs)("span",{children:["SS：",U]}),q&&(0,n.jsxs)("span",{children:["ISO：",q]}),G&&(0,n.jsxs)("span",{children:["IRIS：",G]})]})})]})]})})]})}},2653:(e,t,r)=>{"use strict";r.d(t,{I:()=>l}),r(1938);var n=r(2115),i=r(1396),a=r(6099);function l(){a.r.current||(0,i.U)();let[e]=(0,n.useState)(a.O.current);return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[75,565,441,517,358],()=>t(2977)),_N_E=e.O()}]);